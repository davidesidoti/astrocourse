<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermodynamics Explorer - AstroCourse Physics</title>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@11.8.0/lib/browser/math.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background-color: var(--light-color);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }

        h1 {
            margin-bottom: 10px;
            font-size: 2.2rem;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .visualization-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .visualization {
            flex: 1;
            min-width: 300px;
            height: 400px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .visualization-header {
            background-color: var(--primary-color);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
        }

        .controls-container {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .control {
            flex: 1;
            min-width: 200px;
        }

        .control label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .control input[type="range"] {
            width: 100%;
        }

        .control select {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .value-display {
            display: inline-block;
            min-width: 60px;
            text-align: right;
            font-family: monospace;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        button {
            padding: 8px 16px;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        button.primary {
            background-color: var(--primary-color);
        }

        button.primary:hover {
            background-color: #1a252f;
        }

        button.accent {
            background-color: var(--accent-color);
        }

        button.accent:hover {
            background-color: #c0392b;
        }

        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab:hover {
            background-color: #f5f5f5;
        }

        .tab.active {
            border-bottom-color: var(--secondary-color);
            font-weight: bold;
        }

        .tab-content {
            display: none;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 0 0 8px 8px;
        }

        .tab-content.active {
            display: block;
        }

        .info-panel {
            margin-top: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
        }

        .info-panel h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .info-panel p {
            margin-bottom: 15px;
        }

        .data-display {
            font-family: monospace;
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
            white-space: pre-wrap;
        }

        .canvas-container {
            width: 100%;
            height: 100%;
        }

        .preset-scenarios {
            margin-top: 15px;
        }

        .preset-scenarios select {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            z-index: 100;
            display: none;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin-right: 15px;
        }

        .legend-color {
            width: 15px;
            height: 15px;
            margin-right: 5px;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .visualization {
                min-width: 100%;
            }
            
            .control {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Thermodynamics Explorer</h1>
            <div class="subtitle">Interactive visualization of thermodynamic processes in astronomical contexts</div>
        </header>

        <div class="main-content">
            <div class="tabs">
                <div class="tab active" data-tab="simulator">Simulator</div>
                <div class="tab" data-tab="basics">Thermodynamics Basics</div>
                <div class="tab" data-tab="processes">Thermodynamic Processes</div>
                <div class="tab" data-tab="astronomy">Astronomy Applications</div>
                <div class="tab" data-tab="advanced">Advanced Topics</div>
            </div>

            <div id="simulator" class="tab-content active">
                <div class="visualization-container">
                    <div class="visualization">
                        <div class="visualization-header">PV Diagram</div>
                        <div id="pv-diagram" class="canvas-container"></div>
                    </div>
                    <div class="visualization">
                        <div class="visualization-header">Heat Transfer Simulation</div>
                        <div id="heat-transfer" class="canvas-container"></div>
                    </div>
                </div>

                <div class="controls-container">
                    <h3>Simulation Controls</h3>
                    
                    <div class="control-group">
                        <div class="control">
                            <label for="process-type">Thermodynamic Process:</label>
                            <select id="process-type">
                                <option value="isothermal">Isothermal (Constant Temperature)</option>
                                <option value="adiabatic">Adiabatic (No Heat Transfer)</option>
                                <option value="isobaric">Isobaric (Constant Pressure)</option>
                                <option value="isochoric">Isochoric (Constant Volume)</option>
                                <option value="custom">Custom Process</option>
                            </select>
                        </div>
                        
                        <div class="control">
                            <label for="gas-type">Working Substance:</label>
                            <select id="gas-type">
                                <option value="ideal">Ideal Gas</option>
                                <option value="hydrogen">Hydrogen</option>
                                <option value="helium">Helium</option>
                                <option value="plasma">Stellar Plasma</option>
                                <option value="radiation">Radiation Dominated</option>
                            </select>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control">
                            <label for="temperature">Initial Temperature: <span id="temperature-value" class="value-display">300</span> K</label>
                            <input type="range" id="temperature" min="10" max="10000" value="300" step="10">
                        </div>
                        
                        <div class="control">
                            <label for="pressure">Initial Pressure: <span id="pressure-value" class="value-display">1.0</span> atm</label>
                            <input type="range" id="pressure" min="0.1" max="100" value="1.0" step="0.1">
                        </div>
                        
                        <div class="control">
                            <label for="volume">Initial Volume: <span id="volume-value" class="value-display">1.0</span> m³</label>
                            <input type="range" id="volume" min="0.1" max="10" value="1.0" step="0.1">
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="control">
                            <label for="heat-transfer-rate">Heat Transfer Rate: <span id="heat-rate-value" class="value-display">1.0</span></label>
                            <input type="range" id="heat-transfer-rate" min="0" max="5" value="1.0" step="0.1">
                        </div>
                        
                        <div class="control">
                            <label for="gamma-value">Specific Heat Ratio (γ): <span id="gamma-value-display" class="value-display">1.4</span></label>
                            <input type="range" id="gamma-value" min="1.1" max="1.7" value="1.4" step="0.01">
                        </div>
                    </div>

                    <div class="preset-scenarios">
                        <label for="preset-scenario">Preset Astronomical Scenarios:</label>
                        <select id="preset-scenario">
                            <option value="default">Select a scenario...</option>
                            <option value="stellar-core">Stellar Core Fusion</option>
                            <option value="stellar-atmosphere">Stellar Atmosphere Heating</option>
                            <option value="protostar">Protostar Collapse</option>
                            <option value="planetary-atmosphere">Planetary Atmospheric Processes</option>
                            <option value="accretion-disk">Accretion Disk Heating</option>
                            <option value="supernova">Supernova Expansion</option>
                            <option value="interstellar-cloud">Interstellar Cloud Compression</option>
                        </select>
                    </div>

                    <div class="button-group">
                        <button id="start-simulation" class="primary">Start Simulation</button>
                        <button id="pause-simulation">Pause</button>
                        <button id="reset-simulation" class="accent">Reset</button>
                    </div>
                </div>

                <div class="info-panel">
                    <h3>Simulation Data</h3>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #3498db;"></div>
                            <span>Current Process</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #e74c3c;"></div>
                            <span>Isothermal</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #2ecc71;"></div>
                            <span>Adiabatic</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #f39c12;"></div>
                            <span>Isobaric</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background-color: #9b59b6;"></div>
                            <span>Isochoric</span>
                        </div>
                    </div>
                    <div class="data-display" id="thermo-data">
Temperature: 300 K
Pressure: 1.0 atm
Volume: 1.0 m³
Internal Energy: 0.0 J
Entropy: 0.0 J/K
Work Done: 0.0 J
Heat Transferred: 0.0 J
                    </div>
                </div>
            </div>

            <div id="basics" class="tab-content">
                <h2>Fundamentals of Thermodynamics</h2>
                
                <h3>Key Concepts</h3>
                <p>Thermodynamics is the branch of physics that deals with heat, work, temperature, and their relation to energy, entropy, and the physical properties of matter and radiation. The behavior of these quantities is governed by the four laws of thermodynamics.</p>
                
                <h3>The Laws of Thermodynamics</h3>
                <p><strong>Zeroth Law:</strong> If two systems are each in thermal equilibrium with a third system, they are in thermal equilibrium with each other. This establishes temperature as a fundamental property.</p>
                
                <p><strong>First Law (Conservation of Energy):</strong> Energy cannot be created or destroyed, only transformed from one form to another. Mathematically expressed as ΔU = Q - W, where ΔU is the change in internal energy, Q is heat added to the system, and W is work done by the system.</p>
                
                <p><strong>Second Law (Entropy):</strong> The total entropy of an isolated system never decreases over time. All spontaneous processes increase entropy. This law explains why heat flows from hot to cold bodies and why perfect heat engines are impossible.</p>
                
                <p><strong>Third Law:</strong> As temperature approaches absolute zero, the entropy of a perfect crystal approaches zero. This law provides an absolute reference point for entropy determination.</p>
                
                <h3>State Variables and Equations of State</h3>
                <p>Thermodynamic systems are described by state variables such as temperature (T), pressure (P), volume (V), internal energy (U), enthalpy (H), entropy (S), and Gibbs free energy (G). These variables are related by equations of state, the most famous being the ideal gas law: PV = nRT.</p>
                
                <h3>Heat Capacity and Specific Heat</h3>
                <p>Heat capacity (C) is the amount of heat required to raise the temperature of a substance by one degree. Specific heat capacity (c) is heat capacity per unit mass. For gases, we distinguish between heat capacity at constant pressure (C<sub>p</sub>) and constant volume (C<sub>v</sub>). Their ratio γ = C<sub>p</sub>/C<sub>v</sub> is a critical parameter in adiabatic processes.</p>
                
                <h3>Heat Transfer Mechanisms</h3>
                <p><strong>Conduction:</strong> Heat transfer through direct molecular collision, important in solid bodies like planetary interiors.</p>
                
                <p><strong>Convection:</strong> Heat transfer by mass motion of fluid, dominant in stellar interiors and planetary atmospheres.</p>
                
                <p><strong>Radiation:</strong> Heat transfer via electromagnetic waves, the primary mechanism for energy transport through space and from stars to planets.</p>
            </div>

            <div id="processes" class="tab-content">
                <h2>Thermodynamic Processes</h2>
                
                <h3>Isothermal Process (Constant Temperature)</h3>
                <p>In an isothermal process, the temperature remains constant throughout. For an ideal gas, this means PV = constant (Boyle's Law). Work done during an isothermal expansion or compression is W = nRT ln(V₂/V₁).</p>
                
                <p>Astronomical example: The slow radiative cooling of a white dwarf, where the temperature at any given layer remains nearly constant over short timescales due to the star's high thermal conductivity.</p>
                
                <h3>Adiabatic Process (No Heat Transfer)</h3>
                <p>In an adiabatic process, no heat enters or leaves the system (Q = 0). For an ideal gas, PV<sup>γ</sup> = constant, where γ is the ratio of specific heats (C<sub>p</sub>/C<sub>v</sub>). Temperature and pressure change during an adiabatic process according to TV<sup>γ-1</sup> = constant and T<sup>γ/(γ-1)</sup>P<sup>-1/(γ-1)</sup> = constant.</p>
                
                <p>Astronomical example: The rapid expansion of gas in a supernova explosion, where the expansion happens too quickly for significant heat transfer.</p>
                
                <h3>Isobaric Process (Constant Pressure)</h3>
                <p>In an isobaric process, the pressure remains constant. For an ideal gas, V/T = constant (Charles's Law). Work done during an isobaric process is W = P(V₂ - V₁).</p>
                
                <p>Astronomical example: Heating of a planetary atmosphere at constant pressure, causing it to expand upward.</p>
                
                <h3>Isochoric Process (Constant Volume)</h3>
                <p>In an isochoric (or isovolumetric) process, the volume remains constant. For an ideal gas, P/T = constant (Gay-Lussac's Law). No work is done during an isochoric process (W = 0) since there is no change in volume.</p>
                
                <p>Astronomical example: Heating of a confined gas in a stellar core, where pressure increases with temperature while volume remains nearly constant due to gravitational containment.</p>
                
                <h3>Cyclic Processes and Heat Engines</h3>
                <p>A cyclic process returns the system to its initial state after a series of different processes. Heat engines operate in cycles to convert thermal energy into mechanical work. The Carnot cycle represents the most efficient possible heat engine operating between two temperature reservoirs, with efficiency η = 1 - T<sub>c</sub>/T<sub>h</sub>.</p>
                
                <p>Astronomical example: Convection cycles in stellar interiors, where material heats up, rises, cools, and sinks in a continuous cycle that transports energy outward.</p>
                
                <h3>Phase Transitions</h3>
                <p>Phase transitions (melting, boiling, condensation, etc.) involve heat transfer without temperature change. The latent heat is the energy absorbed or released during a phase transition.</p>
                
                <p>Astronomical example: The condensation of water vapor in planetary atmospheres to form clouds, or the solidification of materials in protoplanetary disks to form planetesimals.</p>
            </div>

            <div id="astronomy" class="tab-content">
                <h2>Thermodynamics in Astronomy</h2>
                
                <h3>Stellar Structure and Evolution</h3>
                <p>Stars are thermodynamic engines that convert nuclear energy into radiation. Their structure is governed by several key thermodynamic principles:</p>
                <ul>
                    <li><strong>Hydrostatic Equilibrium:</strong> The balance between gravitational compression and pressure gradients</li>
                    <li><strong>Thermal Equilibrium:</strong> The balance between energy generation and transport</li>
                    <li><strong>Energy Transport:</strong> Radiation, conduction, and convection mechanisms</li>
                    <li><strong>Nuclear Reactions:</strong> Temperature-dependent processes that generate energy</li>
                </ul>
                
                <p>The evolution of stars represents a sequence of thermodynamic adjustments as energy sources change and composition evolves. For example, when a main sequence star exhausts its core hydrogen, it adjusts its structure, expanding and cooling its outer layers while its core contracts and heats up.</p>
                
                <h3>Planetary Atmospheres</h3>
                <p>Planetary atmospheres are complex thermodynamic systems with multiple interacting components:</p>
                <ul>
                    <li><strong>Vertical Structure:</strong> Determined by hydrostatic balance and heat transport</li>
                    <li><strong>Greenhouse Effect:</strong> Selective absorption and re-radiation of infrared energy</li>
                    <li><strong>Weather Systems:</strong> Result of thermodynamic instabilities and fluid dynamics</li>
                    <li><strong>Climate Evolution:</strong> Long-term thermodynamic changes due to various feedbacks</li>
                </ul>
                
                <p>The comparison of atmospheres across different planets (Earth, Venus, Mars, gas giants) reveals how thermodynamic principles operate under different conditions.</p>
                
                <h3>Accretion Processes</h3>
                <p>Accretion—the accumulation of matter under gravity—involves complex thermodynamics:</p>
                <ul>
                    <li><strong>Gravitational Energy Conversion:</strong> Potential energy transforms to kinetic, then thermal energy</li>
                    <li><strong>Radiative Cooling:</strong> Determines accretion efficiency</li>
                    <li><strong>Viscous Heating:</strong> Generates entropy in differentially rotating flows</li>
                    <li><strong>Outflows and Jets:</strong> Carry away excess energy and angular momentum</li>
                </ul>
                
                <p>These processes power some of the most energetic phenomena in the universe, from quasars to X-ray binaries.</p>
                
                <h3>Interstellar Medium</h3>
                <p>The interstellar medium (ISM) exhibits complex thermodynamic behavior:</p>
                <ul>
                    <li><strong>Multiple Phases:</strong> Hot (10⁶ K), warm (10⁴ K), and cold (10-100 K) gas in approximate pressure equilibrium</li>
                    <li><strong>Heating Mechanisms:</strong> Stellar radiation, cosmic rays, shock waves</li>
                    <li><strong>Cooling Mechanisms:</strong> Line emission, dust radiation, expansion</li>
                    <li><strong>Phase Transitions:</strong> Between neutral and ionized states, molecular and atomic forms</li>
                </ul>
                
                <p>These processes regulate star formation and galactic evolution.</p>
                
                <h3>Cosmological Thermodynamics</h3>
                <p>The evolution of the universe itself can be viewed through a thermodynamic lens:</p>
                <ul>
                    <li><strong>Expansion and Cooling:</strong> Adiabatic expansion of the universe since the Big Bang</li>
                    <li><strong>Cosmic Microwave Background:</strong> Blackbody radiation from the early universe</li>
                    <li><strong>Structure Formation:</strong> Gravitational potential energy converting to kinetic and thermal energy</li>
                    <li><strong>Heat Death:</strong> The potential ultimate fate of the universe as entropy maximizes</li>
                </ul>
            </div>

            <div id="advanced" class="tab-content">
                <h2>Advanced Topics in Astrophysical Thermodynamics</h2>
                
                <h3>Non-equilibrium Thermodynamics</h3>
                <p>Many astronomical systems operate far from thermodynamic equilibrium, requiring more sophisticated analysis than classical equilibrium thermodynamics. Examples include:</p>
                <ul>
                    <li>Shock waves in supernovae and interstellar medium</li>
                    <li>Radiatively driven stellar winds</li>
                    <li>Active galactic nuclei jets</li>
                    <li>Turbulent mixing in stellar interiors</li>
                </ul>
                
                <p>These systems are characterized by energy fluxes, dissipative structures, and self-organization phenomena that can only be understood through non-equilibrium approaches.</p>
                
                <h3>Relativistic Thermodynamics</h3>
                <p>When temperatures or densities become extreme, relativistic effects become important. Relativistic thermodynamics incorporates special and general relativity into thermodynamic descriptions, essential for understanding:</p>
                <ul>
                    <li>Neutron star interiors</li>
                    <li>Black hole thermodynamics</li>
                    <li>Early universe conditions</li>
                    <li>Relativistic jets and outflows</li>
                </ul>
                
                <p>The famous Bekenstein-Hawking entropy formula, S = kA/4l<sub>p</sub><sup>2</sup>, relates a black hole's entropy to its event horizon area, revealing deep connections between gravity, thermodynamics, and quantum theory.</p>
                
                <h3>Quantum Statistical Mechanics</h3>
                <p>Quantum effects dominate thermodynamic behavior in certain astronomical contexts:</p>
                <ul>
                    <li><strong>Degenerate Matter:</strong> Electron degeneracy in white dwarfs, neutron degeneracy in neutron stars</li>
                    <li><strong>Bose-Einstein Condensates:</strong> Possibly relevant in dark matter models</li>
                    <li><strong>Quantum Vacuum Energy:</strong> Potential contributor to dark energy</li>
                    <li><strong>Hawking Radiation:</strong> Quantum effect causing black hole evaporation</li>
                </ul>
                
                <p>These phenomena require quantum statistical mechanics, which accounts for the quantum nature of particles and their indistinguishability.</p>
                
                <h3>Computational Methods</h3>
                <p>Modern astrophysical thermodynamics relies heavily on computational methods:</p>
                <ul>
                    <li><strong>Computational Fluid Dynamics (CFD):</strong> For modeling complex flows</li>
                    <li><strong>Radiation-Hydrodynamics Codes:</strong> Coupling fluid dynamics with radiative transfer</li>
                    <li><strong>Monte Carlo Methods:</strong> For simulating particle interactions and radiative processes</li>
                    <li><strong>N-body Simulations:</strong> For gravitational dynamics coupled with thermodynamics</li>
                </ul>
                
                <p>These computational approaches allow scientists to model complex, non-linear thermodynamic systems that defy analytical solutions.</p>
                
                <h3>Observational Techniques</h3>
                <p>Advanced observational methods provide insights into thermodynamic properties of astronomical objects:</p>
                <ul>
                    <li><strong>Spectroscopy:</strong> Reveals temperature, density, and composition</li>
                    <li><strong>Multi-wavelength Observations:</strong> Probe different temperature regimes</li>
                    <li><strong>Time-domain Astronomy:</strong> Captures dynamic thermodynamic processes</li>
                    <li><strong>Gravitational Wave Astronomy:</strong> Provides new window into extreme thermodynamic events</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const startButton = document.getElementById('start-simulation');
        const pauseButton = document.getElementById('pause-simulation');
        const resetButton = document.getElementById('reset-simulation');
        const processTypeSelect = document.getElementById('process-type');
        const gasTypeSelect = document.getElementById('gas-type');
        const presetScenarioSelect = document.getElementById('preset-scenario');
        const temperatureSlider = document.getElementById('temperature');
        const pressureSlider = document.getElementById('pressure');
        const volumeSlider = document.getElementById('volume');
        const heatRateSlider = document.getElementById('heat-transfer-rate');
        const gammaSlider = document.getElementById('gamma-value');
        const temperatureValue = document.getElementById('temperature-value');
        const pressureValue = document.getElementById('pressure-value');
        const volumeValue = document.getElementById('volume-value');
        const heatRateValue = document.getElementById('heat-rate-value');
        const gammaValueDisplay = document.getElementById('gamma-value-display');
        const thermoData = document.getElementById('thermo-data');

        // Tab switching functionality
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // Remove active class from all tabs and contents
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                tab.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // Slider value updates
        temperatureSlider.addEventListener('input', () => {
            temperatureValue.textContent = temperatureSlider.value;
            updateSimulation();
        });

        pressureSlider.addEventListener('input', () => {
            pressureValue.textContent = pressureSlider.value;
            updateSimulation();
        });

        volumeSlider.addEventListener('input', () => {
            volumeValue.textContent = volumeSlider.value;
            updateSimulation();
        });

        heatRateSlider.addEventListener('input', () => {
            heatRateValue.textContent = heatRateSlider.value;
            updateSimulation();
        });

        gammaSlider.addEventListener('input', () => {
            gammaValueDisplay.textContent = gammaSlider.value;
            updateSimulation();
        });

        // Process type and gas type change handlers
        processTypeSelect.addEventListener('change', updateSimulation);
        gasTypeSelect.addEventListener('change', updateGasProperties);

        // Preset scenario handler
        presetScenarioSelect.addEventListener('change', loadPresetScenario);

        // Button handlers
        startButton.addEventListener('click', startSimulation);
        pauseButton.addEventListener('click', pauseSimulation);
        resetButton.addEventListener('click', resetSimulation);

        // Simulation state
        let simulationRunning = false;
        let animationFrameId = null;
        let simulationTime = 0;
        let simulationData = {
            temperature: 300,
            pressure: 1.0,
            volume: 1.0,
            internalEnergy: 0,
            entropy: 0,
            workDone: 0,
            heatTransferred: 0,
            path: []
        };

        // Gas properties
        const gasProperties = {
            ideal: { name: "Ideal Gas", gamma: 1.4, molarMass: 0.029 },
            hydrogen: { name: "Hydrogen", gamma: 1.41, molarMass: 0.002 },
            helium: { name: "Helium", gamma: 1.66, molarMass: 0.004 },
            plasma: { name: "Stellar Plasma", gamma: 1.33, molarMass: 0.0006 },
            radiation: { name: "Radiation Dominated", gamma: 1.33, molarMass: 0.0001 }
        };

        // Preset scenarios
        const presetScenarios = {
            "stellar-core": {
                name: "Stellar Core Fusion",
                temperature: 1.5e7,
                pressure: 100,
                volume: 1.0,
                gasType: "plasma",
                processType: "adiabatic",
                gamma: 1.33,
                description: "Simulates conditions in a stellar core where nuclear fusion occurs."
            },
            "stellar-atmosphere": {
                name: "Stellar Atmosphere Heating",
                temperature: 6000,
                pressure: 0.1,
                volume: 5.0,
                gasType: "hydrogen",
                processType: "isobaric",
                gamma: 1.41,
                description: "Models the heating of gas in a stellar atmosphere at constant pressure."
            },
            "protostar": {
                name: "Protostar Collapse",
                temperature: 100,
                pressure: 0.01,
                volume: 10.0,
                gasType: "hydrogen",
                processType: "adiabatic",
                gamma: 1.41,
                description: "Simulates the gravitational collapse of a gas cloud forming a protostar."
            },
            "planetary-atmosphere": {
                name: "Planetary Atmospheric Processes",
                temperature: 300,
                pressure: 1.0,
                volume: 1.0,
                gasType: "ideal",
                processType: "isothermal",
                gamma: 1.4,
                description: "Models atmospheric processes on Earth-like planets."
            },
            "accretion-disk": {
                name: "Accretion Disk Heating",
                temperature: 10000,
                pressure: 0.1,
                volume: 2.0,
                gasType: "plasma",
                processType: "isochoric",
                gamma: 1.33,
                description: "Simulates heating in an accretion disk around a compact object."
            },
            "supernova": {
                name: "Supernova Expansion",
                temperature: 5e6,
                pressure: 50,
                volume: 0.1,
                gasType: "plasma",
                processType: "adiabatic",
                gamma: 1.33,
                description: "Models the rapid expansion of gas in a supernova explosion."
            },
            "interstellar-cloud": {
                name: "Interstellar Cloud Compression",
                temperature: 50,
                pressure: 0.001,
                volume: 10.0,
                gasType: "hydrogen",
                processType: "isothermal",
                gamma: 1.41,
                description: "Simulates the compression of an interstellar cloud leading to star formation."
            }
        };

        // Initialize visualizations
        let pvDiagram, heatTransferSim;

        // Initialize the application
        function init() {
            initPVDiagram();
            initHeatTransferSim();
            updateGasProperties();
            updateSimulationData();
        }

        // Initialize PV Diagram
        function initPVDiagram() {
            const container = document.getElementById('pv-diagram');
            
            // Create SVG element
            const width = container.clientWidth;
            const height = container.clientHeight;
            const margin = { top: 40, right: 40, bottom: 60, left: 60 };
            
            const svg = d3.select(container)
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            // Create scales
            const xScale = d3.scaleLinear()
                .domain([0, 10])
                .range([margin.left, width - margin.right]);
            
            const yScale = d3.scaleLinear()
                .domain([0, 100])
                .range([height - margin.bottom, margin.top]);
            
            // Create axes
            const xAxis = d3.axisBottom(xScale);
            const yAxis = d3.axisLeft(yScale);
            
            svg.append('g')
                .attr('transform', `translate(0, ${height - margin.bottom})`)
                .call(xAxis);
            
            svg.append('g')
                .attr('transform', `translate(${margin.left}, 0)`)
                .call(yAxis);
            
            // Add axis labels
            svg.append('text')
                .attr('x', width / 2)
                .attr('y', height - 10)
                .attr('text-anchor', 'middle')
                .text('Volume (m³)');
            
            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', 15)
                .attr('text-anchor', 'middle')
                .text('Pressure (atm)');
            
            // Create path for PV curve
            const pvPath = svg.append('path')
                .attr('fill', 'none')
                .attr('stroke', '#3498db')
                .attr('stroke-width', 3);
            
            // Create reference curves
            const isothermalPath = svg.append('path')
                .attr('fill', 'none')
                .attr('stroke', '#e74c3c')
                .attr('stroke-width', 1.5)
                .attr('stroke-dasharray', '5,5');
            
            const adiabaticPath = svg.append('path')
                .attr('fill', 'none')
                .attr('stroke', '#2ecc71')
                .attr('stroke-width', 1.5)
                .attr('stroke-dasharray', '5,5');
            
            const isobaricPath = svg.append('path')
                .attr('fill', 'none')
                .attr('stroke', '#f39c12')
                .attr('stroke-width', 1.5)
                .attr('stroke-dasharray', '5,5');
            
            const isochoricPath = svg.append('path')
                .attr('fill', 'none')
                .attr('stroke', '#9b59b6')
                .attr('stroke-width', 1.5)
                .attr('stroke-dasharray', '5,5');
            
            // Create current state point
            const statePoint = svg.append('circle')
                .attr('r', 6)
                .attr('fill', '#3498db');
            
            // Store references
            pvDiagram = {
                svg,
                xScale,
                yScale,
                pvPath,
                isothermalPath,
                adiabaticPath,
                isobaricPath,
                isochoricPath,
                statePoint,
                width,
                height,
                margin
            };
            
            // Draw initial reference curves
            updatePVDiagram();
        }

        // Initialize Heat Transfer Simulation
        function initHeatTransferSim() {
            const container = document.getElementById('heat-transfer');
            
            // Create canvas for heat transfer visualization
            const canvas = document.createElement('canvas');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            container.appendChild(canvas);
            
            const ctx = canvas.getContext('2d');
            
            // Store references
            heatTransferSim = {
                canvas,
                ctx,
                width: canvas.width,
                height: canvas.height,
                particles: [],
                heatSources: [],
                heatSinks: []
            };
            
            // Initialize heat transfer simulation
            initializeHeatTransferParticles();
            updateHeatTransferSim();
        }

        // Initialize particles for heat transfer simulation
        function initializeHeatTransferParticles() {
            heatTransferSim.particles = [];
            
            // Create particles representing gas molecules
            const numParticles = 200;
            const temperature = parseFloat(temperatureSlider.value);
            const normalizedTemp = Math.min(temperature / 1000, 10); // Normalize for visual speed
            
            for (let i = 0; i < numParticles; i++) {
                heatTransferSim.particles.push({
                    x: Math.random() * heatTransferSim.width,
                    y: Math.random() * heatTransferSim.height,
                    vx: (Math.random() - 0.5) * normalizedTemp,
                    vy: (Math.random() - 0.5) * normalizedTemp,
                    radius: 3 + Math.random() * 2,
                    temperature: temperature,
                    color: getTemperatureColor(temperature)
                });
            }
            
            // Create heat sources and sinks based on process type
            heatTransferSim.heatSources = [];
            heatTransferSim.heatSinks = [];
            
            const processType = processTypeSelect.value;
            
            if (processType === 'isothermal' || processType === 'isobaric') {
                // Add heat source
                heatTransferSim.heatSources.push({
                    x: heatTransferSim.width * 0.2,
                    y: heatTransferSim.height * 0.5,
                    radius: 30,
                    power: parseFloat(heatRateSlider.value)
                });
            }
            
            if (processType === 'isothermal' || processType === 'isochoric') {
                // Add heat sink
                heatTransferSim.heatSinks.push({
                    x: heatTransferSim.width * 0.8,
                    y: heatTransferSim.height * 0.5,
                    radius: 30,
                    power: parseFloat(heatRateSlider.value)
                });
            }
        }

        // Update gas properties based on selection
        function updateGasProperties() {
            const gasType = gasTypeSelect.value;
            const gas = gasProperties[gasType];
            
            gammaSlider.value = gas.gamma;
            gammaValueDisplay.textContent = gas.gamma;
            
            updateSimulation();
        }

        // Load preset scenario
        function loadPresetScenario() {
            const scenarioKey = presetScenarioSelect.value;
            
            if (scenarioKey === 'default') {
                return;
            }
            
            const scenario = presetScenarios[scenarioKey];
            
            // Update controls
            temperatureSlider.value = scenario.temperature;
            temperatureValue.textContent = scenario.temperature;
            
            pressureSlider.value = scenario.pressure;
            pressureValue.textContent = scenario.pressure;
            
            volumeSlider.value = scenario.volume;
            volumeValue.textContent = scenario.volume;
            
            processTypeSelect.value = scenario.processType;
            gasTypeSelect.value = scenario.gasType;
            
            gammaSlider.value = scenario.gamma;
            gammaValueDisplay.textContent = scenario.gamma;
            
            // Update simulation
            updateGasProperties();
            updateSimulation();
            
            // Reset simulation data
            resetSimulationData();
        }

        // Start simulation
        function startSimulation() {
            if (!simulationRunning) {
                simulationRunning = true;
                animate();
            }
        }

        // Pause simulation
        function pauseSimulation() {
            simulationRunning = false;
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
        }

        // Reset simulation
        function resetSimulation() {
            pauseSimulation();
            resetSimulationData();
            updatePVDiagram();
            initializeHeatTransferParticles();
            updateHeatTransferSim();
        }

        // Reset simulation data
        function resetSimulationData() {
            simulationTime = 0;
            simulationData = {
                temperature: parseFloat(temperatureSlider.value),
                pressure: parseFloat(pressureSlider.value),
                volume: parseFloat(volumeSlider.value),
                internalEnergy: 0,
                entropy: 0,
                workDone: 0,
                heatTransferred: 0,
                path: [{
                    volume: parseFloat(volumeSlider.value),
                    pressure: parseFloat(pressureSlider.value)
                }]
            };
            
            updateSimulationData();
        }

        // Animation loop
        function animate() {
            if (simulationRunning) {
                simulationTime += 0.016; // Approximately 60fps
                
                updateSimulationStep();
                updatePVDiagram();
                updateHeatTransferSim();
                
                animationFrameId = requestAnimationFrame(animate);
            }
        }

        // Update simulation for a single time step
        function updateSimulationStep() {
            const processType = processTypeSelect.value;
            const gasType = gasTypeSelect.value;
            const gamma = parseFloat(gammaSlider.value);
            const heatRate = parseFloat(heatRateSlider.value);
            
            // Current state
            let T = simulationData.temperature;
            let P = simulationData.pressure;
            let V = simulationData.volume;
            let U = simulationData.internalEnergy;
            let S = simulationData.entropy;
            let W = simulationData.workDone;
            let Q = simulationData.heatTransferred;
            
            // Constants
            const R = 8.314; // Gas constant J/(mol·K)
            const n = 1; // Number of moles
            
            // Calculate changes based on process type
            const dt = 0.016; // Time step
            let dV = 0;
            let dP = 0;
            let dT = 0;
            let dU = 0;
            let dS = 0;
            let dW = 0;
            let dQ = 0;
            
            switch (processType) {
                case 'isothermal':
                    // V increases, P decreases, T constant
                    dV = 0.05 * dt;
                    dP = -P * (dV / V); // PV = constant
                    dT = 0;
                    dW = P * dV;
                    dQ = n * R * T * (dV / V);
                    dU = dQ - dW;
                    dS = dQ / T;
                    break;
                    
                case 'adiabatic':
                    // V increases, P and T decrease
                    dV = 0.05 * dt;
                    dP = -gamma * P * (dV / V); // PV^γ = constant
                    dT = -T * (gamma - 1) * (dV / V); // TV^(γ-1) = constant
                    dW = P * dV;
                    dQ = 0; // No heat transfer
                    dU = -P * dV; // First law with dQ = 0
                    dS = 0; // Reversible adiabatic process
                    break;
                    
                case 'isobaric':
                    // V and T increase, P constant
                    dT = heatRate * dt;
                    dV = V * (dT / T); // V/T = constant
                    dP = 0;
                    dW = P * dV;
                    dQ = n * R * dT * (gamma / (gamma - 1)); // Cp = γR/(γ-1)
                    dU = dQ - dW;
                    dS = n * R * gamma * Math.log((T + dT) / T) / (gamma - 1);
                    break;
                    
                case 'isochoric':
                    // P and T increase, V constant
                    dT = heatRate * dt;
                    dP = P * (dT / T); // P/T = constant
                    dV = 0;
                    dW = 0; // No volume change, no work
                    dQ = n * R * dT / (gamma - 1); // Cv = R/(γ-1)
                    dU = dQ; // First law with dW = 0
                    dS = n * R * Math.log((T + dT) / T) / (gamma - 1);
                    break;
                    
                case 'custom':
                    // Custom process with both volume and temperature changes
                    dV = 0.03 * dt;
                    dT = heatRate * 0.5 * dt;
                    dP = (P * dT / T) - (P * dV / V); // Combined effect
                    dW = P * dV;
                    dQ = n * R * dT / (gamma - 1) + n * R * T * (dV / V);
                    dU = dQ - dW;
                    dS = dQ / T;
                    break;
            }
            
            // Update state
            simulationData.volume = Math.max(0.1, Math.min(10, V + dV));
            simulationData.pressure = Math.max(0.1, Math.min(100, P + dP));
            simulationData.temperature = Math.max(10, Math.min(10000, T + dT));
            simulationData.internalEnergy += dU;
            simulationData.entropy += dS;
            simulationData.workDone += dW;
            simulationData.heatTransferred += dQ;
            
            // Add point to path
            simulationData.path.push({
                volume: simulationData.volume,
                pressure: simulationData.pressure
            });
            
            // Limit path length to prevent memory issues
            if (simulationData.path.length > 500) {
                simulationData.path.shift();
            }
            
            // Update display
            updateSimulationData();
        }

        // Update simulation data display
        function updateSimulationData() {
            thermoData.textContent = `Temperature: ${simulationData.temperature.toFixed(1)} K
Pressure: ${simulationData.pressure.toFixed(2)} atm
Volume: ${simulationData.volume.toFixed(2)} m³
Internal Energy: ${simulationData.internalEnergy.toFixed(1)} J
Entropy: ${simulationData.entropy.toFixed(1)} J/K
Work Done: ${simulationData.workDone.toFixed(1)} J
Heat Transferred: ${simulationData.heatTransferred.toFixed(1)} J`;
        }

        // Update PV diagram
        function updatePVDiagram() {
            const { xScale, yScale, pvPath, statePoint } = pvDiagram;
            
            // Update scales based on current data
            xScale.domain([0, Math.max(10, simulationData.volume * 1.5)]);
            yScale.domain([0, Math.max(100, simulationData.pressure * 1.5)]);
            
            // Update PV curve
            const line = d3.line()
                .x(d => xScale(d.volume))
                .y(d => yScale(d.pressure))
                .curve(d3.curveMonotoneX);
            
            pvPath.attr('d', line(simulationData.path));
            
            // Update current state point
            statePoint
                .attr('cx', xScale(simulationData.volume))
                .attr('cy', yScale(simulationData.pressure));
            
            // Update reference curves
            updateReferenceCurves();
        }

        // Update reference curves on PV diagram
        function updateReferenceCurves() {
            const { xScale, yScale, isothermalPath, adiabaticPath, isobaricPath, isochoricPath } = pvDiagram;
            const { temperature, pressure, volume } = simulationData;
            const gamma = parseFloat(gammaSlider.value);
            
            // Generate points for isothermal curve (PV = constant)
            const isothermalPoints = [];
            const PV = pressure * volume;
            for (let v = 0.1; v <= 10; v += 0.1) {
                isothermalPoints.push({
                    volume: v,
                    pressure: PV / v
                });
            }
            
            // Generate points for adiabatic curve (PV^γ = constant)
            const adiabaticPoints = [];
            const PVgamma = pressure * Math.pow(volume, gamma);
            for (let v = 0.1; v <= 10; v += 0.1) {
                adiabaticPoints.push({
                    volume: v,
                    pressure: PVgamma / Math.pow(v, gamma)
                });
            }
            
            // Generate points for isobaric line (P = constant)
            const isobaricPoints = [
                { volume: 0.1, pressure },
                { volume: 10, pressure }
            ];
            
            // Generate points for isochoric line (V = constant)
            const isochoricPoints = [
                { volume, pressure: 0.1 },
                { volume, pressure: 100 }
            ];
            
            // Update paths
            const line = d3.line()
                .x(d => xScale(d.volume))
                .y(d => yScale(d.pressure))
                .curve(d3.curveMonotoneX);
            
            isothermalPath.attr('d', line(isothermalPoints));
            adiabaticPath.attr('d', line(adiabaticPoints));
            isobaricPath.attr('d', line(isobaricPoints));
            isochoricPath.attr('d', line(isochoricPoints));
        }

        // Update heat transfer simulation
        function updateHeatTransferSim() {
            const { ctx, width, height, particles, heatSources, heatSinks } = heatTransferSim;
            
            // Clear canvas
            ctx.clearRect(0, 0, width, height);
            
            // Draw container based on volume
            const volume = simulationData.volume;
            const normalizedVolume = volume / 10; // Normalize to 0-1 range
            const containerWidth = width * (0.3 + normalizedVolume * 0.6);
            const containerHeight = height * 0.8;
            const containerX = (width - containerWidth) / 2;
            const containerY = (height - containerHeight) / 2;
            
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 2;
            ctx.strokeRect(containerX, containerY, containerWidth, containerHeight);
            
            // Draw heat sources
            heatSources.forEach(source => {
                const gradient = ctx.createRadialGradient(
                    source.x, source.y, 0,
                    source.x, source.y, source.radius
                );
                gradient.addColorStop(0, 'rgba(231, 76, 60, 0.8)');
                gradient.addColorStop(1, 'rgba(231, 76, 60, 0)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(source.x, source.y, source.radius, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#e74c3c';
                ctx.beginPath();
                ctx.arc(source.x, source.y, 10, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw heat sinks
            heatSinks.forEach(sink => {
                const gradient = ctx.createRadialGradient(
                    sink.x, sink.y, 0,
                    sink.x, sink.y, sink.radius
                );
                gradient.addColorStop(0, 'rgba(52, 152, 219, 0.8)');
                gradient.addColorStop(1, 'rgba(52, 152, 219, 0)');
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(sink.x, sink.y, sink.radius, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#3498db';
                ctx.beginPath();
                ctx.arc(sink.x, sink.y, 10, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Update and draw particles
            particles.forEach(particle => {
                // Update position
                particle.x += particle.vx;
                particle.y += particle.vy;
                
                // Boundary collision (container)
                if (particle.x - particle.radius < containerX) {
                    particle.x = containerX + particle.radius;
                    particle.vx = -particle.vx;
                } else if (particle.x + particle.radius > containerX + containerWidth) {
                    particle.x = containerX + containerWidth - particle.radius;
                    particle.vx = -particle.vx;
                }
                
                if (particle.y - particle.radius < containerY) {
                    particle.y = containerY + particle.radius;
                    particle.vy = -particle.vy;
                } else if (particle.y + particle.radius > containerY + containerHeight) {
                    particle.y = containerY + containerHeight - particle.radius;
                    particle.vy = -particle.vy;
                }
                
                // Interaction with heat sources
                heatSources.forEach(source => {
                    const dx = particle.x - source.x;
                    const dy = particle.y - source.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < source.radius) {
                        // Increase particle temperature and speed
                        const heatFactor = 1 + (source.power * 0.01 * (1 - distance / source.radius));
                        particle.temperature *= heatFactor;
                        const speedFactor = Math.sqrt(heatFactor);
                        particle.vx *= speedFactor;
                        particle.vy *= speedFactor;
                        particle.color = getTemperatureColor(particle.temperature);
                    }
                });
                
                // Interaction with heat sinks
                heatSinks.forEach(sink => {
                    const dx = particle.x - sink.x;
                    const dy = particle.y - sink.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < sink.radius) {
                        // Decrease particle temperature and speed
                        const coolFactor = 1 - (sink.power * 0.01 * (1 - distance / sink.radius));
                        particle.temperature *= coolFactor;
                        const speedFactor = Math.sqrt(coolFactor);
                        particle.vx *= speedFactor;
                        particle.vy *= speedFactor;
                        particle.color = getTemperatureColor(particle.temperature);
                    }
                });
                
                // Draw particle
                ctx.fillStyle = particle.color;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw pressure indicator
            const pressure = simulationData.pressure;
            const normalizedPressure = Math.min(pressure / 100, 1); // Normalize to 0-1
            const arrowCount = Math.floor(5 + normalizedPressure * 15);
            
            ctx.fillStyle = '#e74c3c';
            ctx.strokeStyle = '#c0392b';
            ctx.lineWidth = 1;
            
            for (let i = 0; i < arrowCount; i++) {
                const x = containerX + containerWidth / 2;
                const y = containerY + containerHeight / arrowCount * (i + 0.5);
                drawPressureArrow(ctx, x, y, 15, normalizedPressure * 10);
            }
        }

        // Draw pressure arrow
        function drawPressureArrow(ctx, x, y, size, width) {
            ctx.beginPath();
            ctx.moveTo(x - size, y);
            ctx.lineTo(x - size / 3, y - width);
            ctx.lineTo(x - size / 3, y - width / 2);
            ctx.lineTo(x + size / 3, y - width / 2);
            ctx.lineTo(x + size / 3, y - width);
            ctx.lineTo(x + size, y);
            ctx.lineTo(x + size / 3, y + width);
            ctx.lineTo(x + size / 3, y + width / 2);
            ctx.lineTo(x - size / 3, y + width / 2);
            ctx.lineTo(x - size / 3, y + width);
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
        }

        // Get color based on temperature
        function getTemperatureColor(temp) {
            // Map temperature to color (blue -> white -> red)
            const normalizedTemp = Math.min(Math.max(temp, 10) / 10000, 1);
            
            if (normalizedTemp < 0.5) {
                // Blue to white
                const intensity = Math.floor(255 * (normalizedTemp * 2));
                return `rgb(${intensity}, ${intensity}, 255)`;
            } else {
                // White to red
                const intensity = Math.floor(255 * (2 - normalizedTemp * 2));
                return `rgb(255, ${intensity}, ${intensity})`;
            }
        }

        // Update simulation based on control changes
        function updateSimulation() {
            updatePVDiagram();
            initializeHeatTransferParticles();
            updateHeatTransferSim();
        }

        // Initialize on load
        window.addEventListener('load', init);
    </script>
</body>
</html>
